<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#ffffff" />
  <title>bi2flört – Kart Oyunu (Prototip)</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --card-w: min(92vw, 460px);
      --radius: 18px;
      --ink: #1e1e1e;
      --muted: #6a6a6a;
      --paper: #ffffff;
      --accent: #5fbf90; /* pastel yeşil */
      --accent-dark: #27996a;
      --bg1: #fff4f7;    /* pastel pembe */
      --bg2: #eef7ff;    /* pastel mavi  */
      --bg3: #f4fff7;    /* pastel mint  */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: Lora, serif; color: var(--ink);
      min-height: 100svh;
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 50%, var(--bg3) 100%);
      display: grid; place-items: center;
      -webkit-tap-highlight-color: transparent; touch-action: manipulation;
    }
    .app {
      width: 100%; height: 100%;
      padding: calc(env(safe-area-inset-top) + 14px) 14px calc(env(safe-area-inset-bottom) + 14px);
      display: grid; grid-template-rows: auto 1fr auto; gap: 12px; align-items: start; justify-items: center;
    }

    /* ——— Üst bar gizli (tutorial yazısız) ——— */
    .topbar { width: 100%; display: grid; gap: 10px; place-items: center; }
    .tutbar{ display:none !important; }

    .stage {
      position: relative;
      width: var(--card-w); height: min(72vh, 640px);
      transition: transform 220ms ease; display: grid; place-items: center;
    }
    @media (prefers-reduced-motion: reduce) { .stage { transition: none; } }

    /* —— Kart arka yüzü: üst üste dizili —— */
    .stack { position: absolute; inset: 0; pointer-events: none; }
    .back {
      position: absolute; inset: 0; margin: 6px; border-radius: var(--radius);
      background: #fff; border: 1px solid #e5efe8;
      box-shadow: 0 8px 20px rgba(0,0,0,.06);
      overflow: hidden; opacity: .22;
    }
    .back::before{ content: ""; position: absolute; inset: 0; opacity: .5;
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='140' viewBox='0 0 200 140'><rect fill='white' width='200' height='140'/><g fill='none' stroke='%2336a66a' stroke-width='5' opacity='.35'><path d='M20,30 q15,-18 30,0 q15,18 30,0' /><path d='M30,95 q18,12 36,0' /><path d='M120,80 q14,-16 28,0' /><path d='M150,40 q10,10 20,0' /></g><g fill='%2336a66a' opacity='.25'><circle cx='150' cy='30' r='8'/><circle cx='60' cy='70' r='6'/></g></svg>");
      background-size: 200px 140px; background-repeat: repeat; filter: saturate(0.8) blur(.2px);
    }
    .back::after{ content: ""; position: absolute; inset: 0;
      background: linear-gradient(180deg, rgba(255,255,255,.8), rgba(255,255,255,.9)),
                  radial-gradient(60% 40% at 70% 0%, rgba(255,255,255,.65), transparent 60%);
      mix-blend-mode: screen;
    }
    .b3{ transform: rotate(-6deg) translateY(10px) scale(.98); opacity: .14; }
    .b2{ transform: rotate(4deg) translateY(16px) scale(.985); opacity: .18; }
    .b1{ transform: rotate(-2deg) translateY(22px) scale(.99); opacity: .22; }

    .card {
      position: relative; width: 100%; height: 100%; background: var(--paper);
      border-radius: var(--radius); box-shadow: 0 10px 26px rgba(0,0,0,.08), 0 2px 6px rgba(0,0,0,.06);
      border: 1px solid #e6e6e6; display: grid; grid-template-rows: 1fr auto; padding: 24px; gap: 8px;
      user-select: none; cursor: pointer; text-align: center; transition: opacity .25s ease, transform .25s ease;
    }
    .stage.tut .card { opacity: 0; transform: scale(.98); pointer-events: none; }
    .card .body { display: grid; place-items: center; padding: 0 6px; }
    .card h1 { margin: 0; font-size: clamp(20px, 4.8vw, 28px); line-height: 1.35; font-weight: 500; }
    .card .watermark { font-weight: 600; font-size: 18px; opacity: .85; color: #2a2a2a; letter-spacing: .2px; }

    .muted { color: var(--muted); }
    .hidden { display: none !important; }

    /* ——— YAZISIZ, DAHA AÇIK ANLATAN TUTORIAL ——— */
    .intro { position:absolute; inset:0; display:grid; place-items:center; padding:16px; }
    .intro .panel { position:relative; width: min(96%, 560px); border-radius: 20px; background:#fff; border:1px solid #eaeaea; box-shadow: 0 18px 42px rgba(0,0,0,.08); padding: 18px; display:grid; gap: 14px; text-align:center; }
    .intro .slides { position:relative; height: 260px; z-index:1; }
    .slide { position:absolute; inset:0; opacity:0; transform: translateY(8px) scale(.98); transition: opacity .4s ease, transform .4s ease; display:grid; place-items:center; gap:10px; padding:8px; }
    .slide.show { opacity:1; transform: translateY(0) scale(1); }

    /* Ek: Tap label */
    .tapLabel { position:absolute; top:10px; left:50%; transform:translateX(-50%); z-index:10; pointer-events:none; font-size:14px; color:#1f2b25; background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.82)); border:1px solid #e8e8e8; padding:8px 14px; border-radius:999px; box-shadow:0 10px 24px rgba(0,0,0,.12), inset 0 0 0 1px rgba(255,255,255,.5); backdrop-filter: blur(6px); animation: tapblink 2.2s ease-in-out infinite; }
    @keyframes tapblink { 0%,100%{opacity:.8; transform:translateX(-50%) scale(1);} 50%{opacity:1; transform:translateX(-50%) scale(1.05);} }

    /* ——— S1: Dokun & Flip ——— */
    .scene { position: relative; width: 230px; height: 170px; }
    .phone { position:absolute; inset:0; margin:auto; width: 200px; height: 140px; border-radius: 22px; background: #f8fafc; border:1px solid #e6e6e6; box-shadow:0 12px 26px rgba(0,0,0,.08); display:grid; place-items:center; }
    .screen { position: relative; width: 180px; height: 120px; border-radius: 16px; background: linear-gradient(135deg,#f9f9ff,#f3fff8); overflow:hidden; }

    .card3d { position:absolute; left:50%; top:50%; width: 120px; height: 80px; transform: translate(-50%,-50%) perspective(800px); transform-style: preserve-3d; animation: flipCycle 3.2s ease-in-out infinite; }
    .face { position:absolute; inset:0; border-radius: 14px; backface-visibility: hidden; -webkit-backface-visibility: hidden; border:1px solid #e6e6e6; box-shadow:0 10px 22px rgba(0,0,0,.08); }
    .front { background:#fff; }
    .backf { background: repeating-linear-gradient(45deg, #e9f6ef, #e9f6ef 8px, #ffffff 8px, #ffffff 16px); transform: rotateY(180deg); }

    .finger { position:absolute; width: 30px; height: 30px; border-radius: 999px; background: var(--accent); right: 24px; bottom: 16px; box-shadow:0 8px 18px rgba(95,191,144,.45); animation: fingerTap 3.2s ease-in-out infinite; }
    .finger::after { content:""; position:absolute; inset:0; border-radius:999px; box-shadow:0 0 0 0 rgba(95,191,144,.35); animation: rip 3.2s ease-in-out infinite; }

    @keyframes flipCycle {
      0% { transform: translate(-50%,-50%) perspective(800px) rotateY(0deg); }
      12% { transform: translate(-50%,-50%) perspective(800px) rotateY(0deg); }
      28% { transform: translate(-50%,-50%) perspective(800px) rotateY(180deg); }
      40% { transform: translate(-50%,-50%) perspective(800px) rotateY(180deg); }
      55% { transform: translate(-50%,-50%) perspective(800px) rotateY(0deg); }
      100% { transform: translate(-50%,-50%) perspective(800px) rotateY(0deg); }
    }
    @keyframes fingerTap {
      0%,10% { transform: translate(0,0) scale(1); opacity: 0; }
      12% { opacity: 1; }
      18% { transform: translate(-60px,-40px) scale(1); }
      22% { transform: translate(-60px,-40px) scale(.88); }
      28% { transform: translate(-60px,-40px) scale(1); }
      45% { opacity: 1; }
      55% { opacity: 0; transform: translate(0,0) scale(1); }
      100% { opacity: 0; }
    }
    @keyframes rip { 0%,10%{ box-shadow:0 0 0 0 rgba(95,191,144,0);} 18%{ box-shadow:0 0 0 0 rgba(95,191,144,.35);} 28%{ box-shadow:0 0 0 18px rgba(95,191,144,0);} 55%{ box-shadow:0 0 0 0 rgba(95,191,144,0);} 100%{ box-shadow:0 0 0 0 rgba(95,191,144,0);} }

    /* ——— S2: 180° dönüş & sırası gelen kişi ——— */
    .rotateDemo { position:absolute; inset:0; display:grid; place-items:center; }
    .turnScene { width:230px; height:170px; position:relative; }
    .turnScene .phone { width:180px; height:120px; }
    .turnScene .screen { width:160px; height:100px; }
    .turnPhone { animation: turnCycle 4.2s ease-in-out infinite; }

    .avatars { position:absolute; inset:0; pointer-events:none; }
    .av { position:absolute; width:28px; height:28px; border-radius:999px; background:linear-gradient(135deg,#ffd3e2,#ffc7ae); box-shadow:0 8px 18px rgba(0,0,0,.08); border:1px solid #f3c3b6; opacity:.6; transform: scale(.9); transition: opacity .3s, transform .3s; }
    .av.top { top:-6px; left: calc(50% - 14px); }
    .av.bot { bottom:-6px; left: calc(50% - 14px); }
    .avatars.active-top .top { opacity:1; transform: scale(1); }
    .avatars.active-bot .bot { opacity:1; transform: scale(1); }

    .ring { position:absolute; width:120px; height:120px; border-radius:999px; border:2px dashed var(--accent); display:grid; place-items:center; }
    .arrow180 { width:0; height:0; border-left:8px solid transparent; border-right:8px solid transparent; border-bottom:14px solid var(--accent-dark); }

    @keyframes turnCycle {
      0%{ transform: rotate(0deg);} 25%{ transform: rotate(180deg);} 50%{ transform: rotate(180deg);} 75%{ transform: rotate(0deg);} 100%{ transform: rotate(0deg);} }

    /* ——— S3: 10 kart ——— */
    .stackDemo { position:absolute; inset:0; display:grid; place-items:center; }
    .miniStack { position:relative; width:150px; height:100px; }
    .mini { position:absolute; width:96px; height:64px; border-radius:12px; background:#fff; border:1px solid #e6e6e6; box-shadow:0 10px 22px rgba(0,0,0,.08); left: calc(50% - 48px); top: calc(50% - 32px); transform-origin: center; }
    .mini.m2{ transform: translate(12px,-8px) rotate(-3deg); opacity:.9; }
    .mini.m3{ transform: translate(-10px,6px) rotate(4deg); opacity:.85; }

    .pips { position:absolute; left:0; right:0; bottom:-6px; display:flex; gap:6px; justify-content:center; }
    .pip { width:8px; height:8px; border-radius:999px; background:#e8f3ee; box-shadow: inset 0 0 0 1px #d9e9e2; }
    .pip.on { background: var(--accent); box-shadow: 0 4px 10px rgba(95,191,144,.35); }

    /* Yazısızlaştırma */
    .intro .slide p, .intro .hint { display:none !important; }

    /* ——— Bitiş Ekranı / Timeline ——— */
    .end { width: var(--card-w); max-width: var(--card-w); background: transparent; border: 0; box-shadow: none; padding: 6px 4px; text-align: left; display: block; }
    .timeline { position: relative; padding-left: 28px; display: grid; gap: 14px; }
    .timeline::before { content: ""; position: absolute; left: 14px; top: 0; bottom: 0; width: 2px; background: linear-gradient(180deg, var(--accent) 0%, var(--accent-dark) 100%); border-radius: 2px; transform: scaleY(0); transform-origin: top; transition: transform 900ms ease-out; }
    .timeline.revealed::before { transform: scaleY(1); }
    .tli { position: relative; display: grid; grid-template-columns: 1fr; }
    .tli .dot { position: absolute; left: 7px; top: 18px; width: 14px; height: 14px; border-radius: 50%; background: var(--accent); box-shadow: 0 8px 18px rgba(95,191,144,.35), 0 0 0 4px rgba(95,191,144,.15); opacity: 0; transform: scale(.6); transition: transform .35s ease, opacity .35s ease; }
    .tli.show .dot { opacity: 1; transform: scale(1); }
    .tile { background: #fff; border: 1px solid #e8e8e8; border-radius: 18px; padding: 14px; box-shadow: 0 12px 26px rgba(0,0,0,.06); opacity: 0; transform: translateY(8px); transition: transform .35s ease, opacity .35s ease; }
    .tli.show .tile { opacity: 1; transform: translateY(0); }
    .tile .head { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .tile h3 { margin: 0; font-size: 14px; font-weight: 600; color: #2a2a2a; }
    .tile .lead { font-size: clamp(16px, 4.2vw, 18px); line-height: 1.4; }
    .tile .sub { font-size: 14px; color: var(--muted); }

    .ico { width: 28px; height: 28px; border-radius: 999px; display: grid; place-items: center; color: #fff; background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%); box-shadow: 0 10px 18px rgba(39,153,106,.25), inset 0 0 0 1px rgba(255,255,255,.35); }
    .ico svg { width: 16px; height: 16px; display: block; }

    .coupon { display: inline-flex; align-items: center; gap: 10px; justify-content: center; padding: 10px 14px; border: 1px dashed #bcbcbc; border-radius: 12px; cursor: pointer; user-select: none; }
    .coupon code { font-weight: 600; font-size: 18px; }
    .coupon .state { font-size: 14px; color: var(--muted); }
    .cta { position: relative; display: inline-block; text-decoration: none; text-align: center; padding: 14px 18px; border-radius: 14px; background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%); color: #fff; font-weight: 700; }
    .cta::after { content:""; position: absolute; inset: 0; background: linear-gradient(90deg, rgba(255,255,255,.0) 0%, rgba(255,255,255,.5) 50%, rgba(255,255,255,.0) 100%); transform: translateX(-120%); }
    .cta:active { transform: translateY(1px); }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="topbar">
      <div id="tutorial" class="tutbar" role="button" tabindex="0" aria-label="Oyuna geç">
        <strong>Oyuna geç</strong><span class="sep"> • </span><span id="tutHint">Kısa bir anlatımdan sonra dokunup başlayın.</span>
      </div>
    </div>

    <div class="stage tut" id="stage" aria-live="polite" aria-atomic="true">
      <div class="stack" aria-hidden="true">
        <div class="back b3"></div>
        <div class="back b2"></div>
        <div class="back b1"></div>
      </div>

      <!-- YAZISIZ, ZENGİN ANİMASYONLU TUTORIAL -->
      <div class="intro" id="intro" role="button" aria-label="Oyunu anlatım. Dokununca oyuna geçer." tabindex="0">
        <div class="panel">
          <div class="tapLabel" aria-hidden="true">Oyuna geçmek için dokun</div>
          <div class="slides">
            <!-- S1: Tap & Flip -->
            <div class="slide s1 show">
              <div class="scene tapScene">
                <div class="phone">
                  <div class="screen">
                    <div class="card3d">
                      <div class="face front"></div>
                      <div class="face backf"></div>
                    </div>
                  </div>
                </div>
                <div class="finger"></div>
              </div>
            </div>
            <!-- S2: 180° dönüş & sırası gelen kişi -->
            <div class="slide s2">
              <div class="scene turnScene">
                <div class="ring"><div class="arrow180"></div></div>
                <div class="avatars active-top" id="avatars">
                  <div class="av top"></div>
                  <div class="av bot"></div>
                </div>
                <div class="phone turnPhone">
                  <div class="screen"></div>
                </div>
              </div>
            </div>
            <!-- S3: Rastgele 10 kart → pips -->
            <div class="slide s3">
              <div class="scene">
                <div class="stackDemo">
                  <div class="miniStack">
                    <div class="mini m1"></div>
                    <div class="mini m2"></div>
                    <div class="mini m3"></div>
                    <div class="pips" id="pips">
                      <span class="pip"></span><span class="pip"></span><span class="pip"></span><span class="pip"></span><span class="pip"></span>
                      <span class="pip"></span><span class="pip"></span><span class="pip"></span><span class="pip"></span><span class="pip"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card" id="card" role="button" tabindex="0" aria-label="Kart. İleri gitmek için dokun, boşluk ya da sağ ok tuşuna bas.">
        <div class="body">
          <h1 id="cardText">Yükleniyor…</h1>
        </div>
        <div class="watermark">bi2flört</div>
      </div>
    </div>

    <div id="end" class="end hidden" aria-live="polite">
      <div class="timeline" id="timeline">
        <div class="tli" id="tl-duration">
          <div class="dot" aria-hidden="true"></div>
          <div class="tile">
            <div class="head">
              <span class="ico" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 2"/></svg></span>
              <h3>Süre</h3>
            </div>
            <div id="duration" class="lead">—</div>
          </div>
        </div>
        <div class="tli" id="tl-summary">
          <div class="dot" aria-hidden="true"></div>
          <div class="tile">
            <div class="head">
              <span class="ico" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l2.2 4.6L19 9l-4.4 1.8L12 16l-2.6-5.2L5 9l4.8-2.4L12 2z"/></svg></span>
              <h3>Deneyim Özeti</h3>
            </div>
            <div id="expSummary" class="sub">—</div>
          </div>
        </div>
        <div class="tli" id="tl-offer">
          <div class="dot" aria-hidden="true"></div>
          <div class="tile">
            <div class="head">
              <span class="ico" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="8" width="18" height="12" rx="2"/><path d="M12 8v12"/><path d="M3 12h18"/><path d="M12 8c-1.7 0-3-1.3-3-3 0-1.1.9-2 2-2 1.2 0 2.5 1 3 2 .5-1 1.8-2 3-2 1.1 0 2 .9 2 2 0 1.7-1.3 3-3 3H12z"/></svg></span>
              <h3>Teklif</h3>
            </div>
            <div class="lead">deneme nasıldı bilmiyoruz ama tamamından çok zevk alacağınıza eminiz hemen %10 indirimle satın almak için aşağıdaki butona bas</div>
          </div>
        </div>
        <div class="tli" id="tl-coupon">
          <div class="dot" aria-hidden="true"></div>
          <div class="tile">
            <div class="head">
              <span class="ico" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 8a2 2 0 0 1 2-2h14v4a2 2 0 0 0 0 4v4H5a2 2 0 0 1-2-2v-2a2 2 0 0 0 0-4V8z"/><path d="M12 6v12" stroke-dasharray="3 3"/></svg></span>
              <h3>İndirim Kodu</h3>
            </div>
            <div id="coupon" class="coupon" role="button" aria-label="İndirim kodunu kopyala" tabindex="0">
              <code id="couponCode">deneme10</code>
              <span class="state" id="couponState">Kopyala</span>
            </div>
          </div>
        </div>
        <div class="tli" id="tl-cta">
          <div class="dot" aria-hidden="true"></div>
          <div class="tile">
            <div class="head">
              <span class="ico" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 7h12l-1 12H7L6 7z"/><path d="M9 7a3 3 0 0 1 6 0"/></svg></span>
              <h3>Satın Alma</h3>
            </div>
            <a class="cta" id="cta" href="https://bi2shop.com/" target="_blank" rel="noopener">hemen al yarın kargolansın</a>
          </div>
        </div>
      </div>
    </div>

    <div class="muted" id="progress">0 / 10</div>
  </div>

  <script>
    const PAGE_LOADED_AT = Date.now();

    // ——— Kart Havuzu (30) ———
    const MASTER = [
      "Bir dakika boyunca birbirinizin gözlerine bakın, ilk kırpan ceza kartı çeker. Kimse kırpmazsa belki öpüşürsünüz zaten.",
      "Şu an bulunduğun ortamda sana en garip ve en hoş gelen nesneleri söyle ve neden böyle düşündüğünü açıkla.",
      "Karşı tarafın boynunu nota nota öperek bir şarkı mırıldan. Bilemezse bir ceza kartı çeksin.",
      "Bir şarkı seç ve  karşı tarafa bu şarkının nasıl bir sahnenin arka planında çalacağını anlattır.",
      "Bir sır ver ama iyi bi’ sır olsun.",
      "Geçmiş kartlardan istediğin birini kullanma hakkı. (İstediğin zaman kullanabilirsin. Soru veya ceza kartı fark etmez.)",
      "Sırayla birbirinizde en çok hoşunuza giden şeyi söyleyin.",
      "Ceza kartı çek",
      "Karşı tarafa kendi hayatınla ilgili 2’si doğru 1’i yalan 3 cümle söyle, karşı taraf hangisinin yalan olduğunu bulmaya çalışsın. (Bulamazsa ceza kartı çeksin.)",
      "Güven düşüşü oyunu oynayın. (Kartı çeken kişi arkası dönük şekilde kendini bırakır ve karşısındaki onu tutar.)",
      "Bu kartı istediğin zamanda kullanarak karşı tarafın istediği bir yerine şaplak atabilirsin.",
      "Üç ay sonra hayatında ne değişmiş olacak? Anlat.",
      "Seks sırasında en iyi olduğun pozisyonu söyle.",
      "En sevdiğin 3 yetişkin film kategorisini söyle.",
      "En büyük flört sinyalin nedir? Hangi hareketi yaptıysan flörtleştiğini istemeden de olsa gösterirsin.",
      "Sekste olmazsa olmaz dediğin şey nedir?",
      "Kim daha fazla sarhoş hissediyorsa bir kart daha çeksin; eğer kimse sarhoş hissetmiyorsa alkollerinizden yudumlayın.",
      "En sevdiğin üç seks pozisyonunu söyle ve birini karşı tarafın üstünde göster.",
      "Arkadaş ortamında bir lakabın var mı? Yoksa ne olabilirdi?",
      "Sorgusuz sualsiz 3 ceza kartı çek.",
      "Son ceza kartını çeken kişi 2 ceza kartı daha çeksin.",
      "Evde bir kedi varsa kucağına almaya çalış, yoksa karşındakini kucağına al ve sonraki tur bitene kadar kucağında otursun.",
      "Misafir olan kişi bir ceza kartı çeksin.",
      "Karşındakiyle ilk tanıştığında ne düşündün ve ne çıktı?",
      "Uyurken sarılmayı sevenlerden misin?",
      "Bu flörtte ilk kim kime yürüdü.",
      "Arkadaş ortamında en çok aldığın eleştiri nedir?",
      "Çocukluğuna dair en güzel anın nedir?",
      "Yaşlanmak istediğin şehir veya ülke hangisi?",
      "Alkoller bittiyse tam şu an tazeleme vakti, eğer bitmediyse bi yudum daha alın."
    ];

    // ——— Seçili Deste (10 rastgele) ———
    let deck = [];
    let i = 0;
    let ended = false;
    let tutOpen = true; // inline tutorial başlangıçta açık
    let gameStartedAt = null;

    const stage = document.getElementById('stage');
    const card = document.getElementById('card');
    const cardText = document.getElementById('cardText');
    const progress = document.getElementById('progress');

    const end = document.getElementById('end');
    const durationEl = document.getElementById('duration');
    const expSummaryEl = document.getElementById('expSummary');
    const coupon = document.getElementById('coupon');
    const couponCode = document.getElementById('couponCode');
    const couponState = document.getElementById('couponState');
    const timeline = document.getElementById('timeline');

    const tutorial = document.getElementById('tutorial');
    const tutHint = document.getElementById('tutHint');
    const intro = document.getElementById('intro');

    function randInt(max){
      if (window.crypto && window.crypto.getRandomValues) {
        const buf = new Uint32Array(1); window.crypto.getRandomValues(buf);
        return Math.floor((buf[0] / 4294967296) * max);
      }
      return Math.floor(Math.random() * max);
    }

    function pickRandom(arr, n){
      const idxs = new Set();
      while (idxs.size < n) idxs.add(randInt(arr.length));
      return [...idxs].map(k => arr[k]);
    }

    function applyOrientation(){
      const angle = (i % 2 === 0) ? 0 : 180;
      stage.style.transform = `rotate(${angle}deg)`;
    }

    function render(){
      cardText.textContent = deck[i] || "";
      progress.textContent = `${Math.min(i+1, deck.length)} / ${deck.length}`;
      applyOrientation();
    }

    function startGameClock(){ if (!gameStartedAt) gameStartedAt = Date.now(); }

    function minutesPlayed(){
      const start = gameStartedAt || PAGE_LOADED_AT;
      const ms = Math.max(0, Date.now() - start);
      return Math.max(1, Math.ceil(ms / 60000)); // dakikayı yukarı yuvarla, min 1
    }

    function categorize(text){
      const t = text.toLowerCase();
      if (t.includes('ceza')) return 'ceza';
      if (t.includes('seks') || t.includes('öp') || t.includes('şaplak') || t.includes('boynunu') || t.includes('sarıl') || t.includes('kucağı')) return 'romantik/fiziksel';
      if (t.includes('oyunu') || t.includes('oynayın') || t.includes('tutar') || t.includes('bırakır')) return 'oyun/aksiyon';
      if (t.includes('alkol') || t.includes('sarhoş') || t.includes('yudum')) return 'içki';
      if (t.includes('geçmiş kartlardan')) return 'joker';
      return 'sohbet/itiraf';
    }

    function buildExperienceSummary(cards){
      const counts = {};
      cards.forEach(c => { const k = categorize(c); counts[k] = (counts[k]||0)+1; });
      const entries = Object.entries(counts).sort((a,b) => b[1]-a[1]);
      if (!entries.length) return 'Kısa ve dengeli bir tur oldu.';
      const [top] = entries[0];
      const second = entries[1];
      const label = {
        'sohbet/itiraf':'sohbet ağırlıklı',
        'romantik/fiziksel':'romantik/fiziksel temaslı',
        'ceza':'rekabet ve ceza odaklı',
        'oyun/aksiyon':'hareketli/oyunsu',
        'içki':'içkili',
        'joker':'jokerli, esnek kurallı'
      }[top] || top;
      let s = `Özet: ${label} bir tur oynadınız`;
      if (second) {
        const [k2] = second;
        const map2 = {
          'sohbet/itiraf':'; sohbetler ikinci plandaydı',
          'romantik/fiziksel':'; romantik anlar da vardı',
          'ceza':'; biraz da ceza çıktı',
          'oyun/aksiyon':'; hareketli görevler eşlik etti',
          'içki':'; içkili kartlar da görüldü',
          'joker':'; ara ara joker etkisi de oldu'
        };
        s += (map2[k2] || '');
      }
      s += '.';
      return s;
    }

    function revealTimeline() {
      const order = ['tl-duration','tl-summary','tl-offer','tl-coupon','tl-cta'];
      order.forEach((id, idx) => setTimeout(() => {
        const el = document.getElementById(id);
        if (el) el.classList.add('show');
      }, 180 * idx));
      timeline.classList.add('revealed');
    }

    function showEnd(){
      ended = true;
      stage.classList.add('hidden');
      end.classList.remove('hidden');

      const mins = minutesPlayed();
      durationEl.textContent = `${mins} dakika oynadınız`;
      expSummaryEl.textContent = buildExperienceSummary(deck);

      revealTimeline();
    }

    function hideEnd(){
      ended = false;
      stage.classList.remove('hidden');
      end.classList.add('hidden');
      timeline.classList.remove('revealed');
      ['tl-duration','tl-summary','tl-offer','tl-coupon','tl-cta'].forEach(id=>{
        const el = document.getElementById(id); if (el) el.classList.remove('show');
      });
    }

    function next(){
      if (ended || tutOpen) return;
      if (navigator.vibrate) navigator.vibrate(10);
      if (i < deck.length - 1) { i += 1; render(); }
      else { showEnd(); }
    }

    function reshuffle(){ deck = pickRandom(MASTER, 10); i = 0; hideEnd(); render(); }

    async function copyCoupon(){
      const text = couponCode.textContent.trim();
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          const ta = document.createElement('textarea');
          ta.value = text; document.body.appendChild(ta); ta.select();
          document.execCommand('copy'); document.body.removeChild(ta);
        }
        couponState.textContent = 'Kopyalandı!';
        setTimeout(() => couponState.textContent = 'Kopyala', 1800);
      } catch (e) {
        couponState.textContent = 'Kopyalanamadı';
        setTimeout(() => couponState.textContent = 'Kopyala', 1800);
      }
    }

    function showTutorial(){
      if (!tutOpen){
        tutOpen = true; stage.classList.add('tut'); tutorial.classList.remove('hidden'); intro.classList.remove('hidden');
        runStepper(); startIntro();
      }
    }
    function hideTutorial(){
      if (tutOpen){
        tutOpen = false; startGameClock(); stage.classList.remove('tut'); tutorial.classList.add('hidden'); intro.classList.add('hidden'); stopIntro();
      }
    }

    // ——— Inline tutorial ipuçları (üst bar - gizli ama kalsın) ———
    let tIdx = 0; let tTimer;
    const TIPS = [ 'Telefona sırayla dokunun; kart açılır.', 'Her kartta sahne 180° döner; karşı taraf düz okur.', 'Her oyunda rastgele 10 kart gelir. Bittiğinde indirim sürprizi!' ];
    function runStepper(){ if (!tutHint) return; tutHint.textContent = TIPS[tIdx]; clearTimeout(tTimer); tTimer = setTimeout(() => { tIdx = (tIdx + 1) % TIPS.length; runStepper(); }, 2600); }

    // ——— Tutorial animasyon kontrol ———
    let introIdx = 0; let introTimer; let slides;
    function showSlide(k){ if (!slides) return; slides.forEach((el, idx)=> el.classList.toggle('show', idx===k)); }
    function startIntro(){
      slides = Array.from(document.querySelectorAll('#intro .slide'));
      introIdx = 0; showSlide(introIdx);
      // S2 avatar highlight döngüsü
      const avatars = document.getElementById('avatars');
      let avTop = true;
      setInterval(()=>{ if (!tutOpen) return; avTop = !avTop; avatars.classList.toggle('active-top', avTop); avatars.classList.toggle('active-bot', !avTop); }, 2100);
      // S3 pips akışı
      const pips = (document.getElementById('pips')||{}).children || [];
      let pipIdx = 0; setInterval(()=>{ if (!tutOpen) return; for(let j=0;j<pips.length;j++){ pips[j].classList.toggle('on', j<=pipIdx); } pipIdx = (pipIdx+1)%10; }, 380);
      clearTimeout(introTimer); introTimer = setTimeout(cycleIntro, 3000);
    }
    function stopIntro(){ clearTimeout(introTimer); }
    function cycleIntro(){ if (!tutOpen) return; introIdx = (introIdx + 1) % 3; showSlide(introIdx); introTimer = setTimeout(cycleIntro, 3200); }

    // Etkileşimler
    card.addEventListener('click', next);
    tutorial.addEventListener('click', () => { if (tutOpen) hideTutorial(); });
    tutorial.addEventListener('keydown', (e) => { if ((e.key === 'Enter' || e.key === ' ') && tutOpen) { e.preventDefault(); hideTutorial(); } });
    intro.addEventListener('click', () => { if (tutOpen) hideTutorial(); });
    intro.addEventListener('keydown', (e) => { if ((e.key === 'Enter' || e.key === ' ') && tutOpen) { e.preventDefault(); hideTutorial(); } });
    coupon.addEventListener('click', copyCoupon);

    document.addEventListener('keydown', (e) => {
      if (tutOpen && (e.key === ' ' || e.key === 'Enter' || e.key === 'Escape')) { hideTutorial(); return; }
      if (e.key === 'ArrowRight' || e.key === ' ') next();
    });

    // İlk kurulum

    reshuffle(); runStepper(); startIntro();

    // ——— Otomatik Testler ———
    (function selfTest(){
      const snap = { i, ended, tutOpen };
      try {
        console.assert(Array.isArray(MASTER), 'MASTER bir dizi olmalı');
        console.assert(MASTER.length === 30, 'MASTER 30 kart içermeli');
        console.assert(new Set(MASTER).size === MASTER.length, 'MASTER içinde tekrar eden kart olmamalı');
        console.assert(deck.length === 10, 'İlk reshuffle sonrası deste 10 olmalı');
        console.assert(new Set(deck).size === 10, 'Destedeki kartlar benzersiz olmalı');
        const allInMaster = deck.every(x => MASTER.includes(x));
        console.assert(allInMaster, 'Destedeki tüm kartlar MASTER içinde olmalı');
        // Tutorial başlangıçta açık ve intro görünür olmalı
        console.assert(tutOpen === true, 'Tutorial başlangıçta açık olmalı');
        console.assert(document.getElementById('intro') && !document.getElementById('intro').classList.contains('hidden'), 'Intro görünür olmalı');
        console.assert(stage.classList.contains('tut'), 'Stage tut sınıfı almalı');
        // Tutorial tıklama ile kapanmalı
        document.getElementById('intro').dispatchEvent(new Event('click'));
        console.assert(tutOpen === false && document.getElementById('intro').classList.contains('hidden'), 'Intro tıklanınca kapanmalı');
        // Bitiş ekranı
        const saveI = i; i = deck.length - 1; render(); next();
        console.assert(ended === true && !end.classList.contains('hidden'), 'Son karttan sonra bitiş ekranı açılmalı');
        console.assert(/dakika/.test(document.getElementById('duration').textContent), 'Süre metni görünmeli');
        console.assert(document.getElementById('expSummary').textContent.length > 4, 'Özet metni görünmeli');
        const tl = document.querySelector('.timeline');
        console.assert(!!tl && tl.classList.contains('revealed'), 'Timeline revealed olmalı');
        // Geri yükle
        reshuffle(); hideEnd(); if (snap.tutOpen) { showTutorial(); } else { hideTutorial(); }
        i = snap.i; if (snap.ended) showEnd(); else { render(); }
        console.log('%cSelf-test: OK','padding:4px 8px;border:1px solid #0a0;color:#0a0');
      } catch (e) { console.error('Self-test hata:', e); }
    })();
  </script>
</body>
</html>
